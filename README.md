# Modpack Doctor

Инструмент для анализа модпаков Minecraft: показывает зависимости, конфликты, потенциальные проблемы и предлагает оптимизацию под ваш ПК (JVM-аргументы и рекомендации по производительным модам).

Возможности:
- Поддержка Fabric, Quilt и Forge: парсинг `fabric.mod.json`, `quilt.mod.json`, `META-INF/mods.toml`.
- Отчет по каждому моду: модид, версия, описание, авторы, окружение (client/server/both), зависимости, конфликты.
- Поиск:
  - Отсутствующие зависимости (required).
  - Дубликаты модов (несколько версий одного модида).
  - Явные конфликты (из манифестов).
  - Известные конфликты (встроенная база + автообновляемые данные из репозитория).
  - Потенциальные конфликты (эвристики: Sodium vs OptiFine, Starlight vs Phosphor и т. п.).
  - Смешение загрузчиков (Fabric/Forge/Quilt) в одной папке mods.
- Оптимизация:
  - Рекомендация объема RAM.
  - Генерация актуальных JVM-аргументов для Java 17 (G1GC).
  - Список недостающих производительных модов (по загрузчику).
- Обогащение из интернета (опционально):
  - Modrinth API по SHA-1 (`--online`).
  - CurseForge API (`--curseforge`), с извлечением зависимостей/совместимых версий и ссылок.

## Требования

- Python 3.10+ (рекомендуется 3.11+)
- Пакеты:
  - `psutil` — определение объема RAM (опционально)
  - `requests` — Modrinth/CurseForge и автообновление баз
  - `tomli` — если Python < 3.11

Установка:
```bash
pip install -r requirements.txt
```

## Быстрый старт

1) Поместите `modpack_doctor.py` рядом с папкой `mods`, либо выше.
2) Запустите:
```bash
python modpack_doctor.py /путь/к/папке/mods --online --curseforge --ram-gb 6
```

Параметры:
- `mods_dir` — путь к папке `mods`.
- `--online` — Modrinth обогащение.
- `--curseforge` — CurseForge обогащение, ключ через `--curseforge-key` или `CURSEFORGE_API_KEY`.
- `--mc 1.20.1` — целевая версия Minecraft (опционально).
- `--loader fabric|forge|quilt|neoforge` — целевой загрузчик (опционально).
- `--ram-gb 6` — вручную задать объем RAM.
- `--out` — папка для отчетов (по умолчанию `mods/modpack_doctor_output`).

## Автообновление баз данных

Скрипт автоматически подтягивает свежие базы из ветки `main` этого репозитория раз в 7 дней.

Флаги:
- `--db-update now` — обновить базы немедленно.
- `--db-ttl 7d` — периодичность проверки (`1d`, `7d`, `30d`, секунды).
- `--db-channel main|release` — канал (сейчас поддержан `main`; `release` зарезервирован).
- `--db-url <url>` — дополнительные источники (можно указать несколько раз).
- `--no-db-update` — отключить сетевые обновления, использовать локальные файлы.

Слияние источников:
1. Локальные файлы: `data/known_conflicts.json`, `data/performance_mods.json`.
2. Удалённые (ветка main): дополняют локальные.
3. Локальные оверрайды: `data/local_conflicts.json` (если есть) — применяются последними.

В отчёте (`modpack_report.md`) отображается информация о канале, источниках, времени проверки.

## Безопасность ключа CurseForge

- НЕ коммитьте ключ в репозиторий.
- Передавайте ключ через:
  - переменную окружения `CURSEFORGE_API_KEY`, или
  - параметр `--curseforge-key <ключ>`, или
  - секрет репозитория GitHub `CURSEFORGE_API_KEY` (Actions).

## Примеры запуска

- Принудительно обновить базы и собрать отчёт:
```bash
python modpack_doctor.py "D:/Minecraft/instances/MyPack/mods" --online --curseforge --db-update now --ram-gb 8
```

- Обычный анализ:
```bash
python modpack_doctor.py "/home/user/.minecraft/mods" --online --curseforge
```

## Результат работы

В каталоге вывода:
- `modpack_report.json` — полные технические данные.
- `modpack_report.md` — удобочитаемый отчет.
- `recommended_jvm_args.txt` — рекомендуемые JVM-аргументы.
- `curseforge_cache.json` — кэш ответов CurseForge.
- `db_cache_meta.json` — состояние автообновления баз.

## Примечания и ограничения

- Проверка версий зависимостей Forge (`versionRange`) упрощенная.
- CurseForge сопоставление делается по имени/slug и релевантному файлу; у старых модов может срабатывать не всегда.
- Эвристики конфликтов не гарантируют 100% точность.
- Скрипт ничего не изменяет в ваших файлах — только анализ и рекомендации.

## Лицензия

MIT (см. LICENSE).